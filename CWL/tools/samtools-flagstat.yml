#!/usr/bin/env cwl-runner

# source: GGR-cwl / peak_calling / samtools-extract-number-mapped-reads.cwl 
cwlVersion: "cwl:draft-3"

class: CommandLineTool
description: "Extract mapped reads from BAM file using Samtools flagstat command"

hints:
  - class: ResourceRequirement
    coresMin: 1
    ramMin: 10000
#  - class: DockerRequirement
#    dockerPull: 'dukegcb/samtools'

requirements:
  - class: InlineJavascriptRequirement
  - class: ShellCommandRequirement

inputs:
  - id: "#input_bam_file"
    type: string
    description: "Aligned BAM file to filter"
    inputBinding:
      position: 1
  - id: "#output_suffix"
    type: string
    default: ".flagStat"
outputs:
  - id: "#output"
    type: File
    description: "Samtools Flagstat report file"
    outputBinding:
      glob: $(inputs.input_bam_file.path.replace(/^.*[\\\/]/, '').replace(/\.[^/.]+$/, "") + inputs.output_suffix)

baseCommand: ["samtools", "flagstat"]
stdout: $(inputs.input_bam_file.path.replace(/^.*[\\\/]/, '').replace(/\.[^/.]+$/, "") + inputs.output_suffix)
#arguments:
#  - valueFrom: " | head -n1 | cut -f 1 -d ' '"
#    position: 10000
#    shellQuote: False