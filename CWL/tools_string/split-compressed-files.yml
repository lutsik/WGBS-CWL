#!/usr/bin/env cwl-runner
cwlVersion: "cwl:draft-3"
class: CommandLineTool
#
requirements:
# - class: CreateFileRequirement
#   fileDef:
#     - filename: zcat_split.sh
#       fileContent: "zcat $1 | split - $2 $3"
#- $import: envvar-global.yml
#- $import: alea-docker.yml
#- class: InlineJavascriptRequirement
- class: ShellCommandRequirement

hints:
  - class: ResourceRequirement
    coresMin: 1
    ramMin: 15000
    diskMin: 15000

inputs:

- id: "file_dir"
  type: string
  inputBinding:
    position: 1

- id: "file"
  type: string
  description: |
    the input fastq file
  inputBinding:
    position: 1002

- id: "size"
  type: int
  description: |
    size of a chunck in lines
  inputBinding:
    prefix: --lines=
    position: 10004
    separate: False
    valueFrom: $(self * 4)
    
- id: "max_reads"
  type: int
  description: |
    take at most max_reads reads
    
- id: "suffix"
  type: string
  description: |
    a suffix for chuncks
  inputBinding:
    prefix: --additional-suffix=
    position: 10003
    separate: False
  
outputs:
- id: "output"
  type:
    type: array
    items: string
  outputBinding:
    glob: "list_of_files"
    loadContents: true
    outputEval: $(self[0].contents.split("\n").filter(function(n){ return n != "" }))

baseCommand: ["cd"]
arguments:
- valueFrom: ";"
  position: 1000
- valueFrom: "zcat"
  position: 1001
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return "|";
         }else{
               return "";
         }
     }
  position: 2000
  shellQuote: false
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return "head";
         }else{
               return "";
         }
     }
  position: 2001
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return "-n";
         }else{
               return "";
         }
     }
  position: 2002
  shellQuote: false
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return inputs.max_reads*4;
         }else{
               return "";
         }
     }
  position: 2003
  shellQuote: false
- valueFrom: "|"
  position: 10000
  shellQuote: false
- valueFrom: "split"
  position: 10001
- valueFrom: "-"
  position: 10002
  shellQuote: false
  shellQuote: false
- valueFrom: ";"
  position: 100000
  shellQuote: true
- valueFrom: "ls -1"
  position: 100001
  shellQuote: false
- valueFrom: "|"
  position: 100002
  shellQuote: false
- valueFrom: "grep"
  position: 100003
  shellQuote: false
- valueFrom: "$(inputs.suffix)"
  position: 100004
  shellQuote: false
stdout: "list_of_files"
#- valueFrom: "\""
#  position: 10005
#  shellQuote: false



#- valueFrom: "zcat_split.sh"
#  position: 1
