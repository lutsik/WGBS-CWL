#!/usr/bin/env cwl-runner

# Command Line:
# zcat <file> | 'head -n  <max_reads*4> | \
# split - --additional-suffix=<suffix_derived_from_filename> --lines=<size>
#
# Notes: head only executed for max_reads > 0


cwlVersion: "cwl:draft-3"
class: CommandLineTool
requirements:
- class: ShellCommandRequirement

hints:
  - class: ResourceRequirement
    coresMin: 1
    ramMin: 15000
    diskMin: 15000

inputs:

- id: "file"
  type: File
  description: |
    the input fastq file
  inputBinding:
    position: 1

- id: "size"
  type: int
  description: |
    size of a chunck in lines
  inputBinding:
    prefix: --lines=
    position: 205
    separate: False
    valueFrom: $(self * 4)
    
- id: "max_reads"
  type: int
  description: |
    take at most max_reads reads
  
  
outputs:
- id: "output"
  type:
    type: array
    items: File
  outputBinding:
    glob: $("*" + inputs.file.basename.replace(/\.fastq.*/i,"_splitted.fastq"))

baseCommand: ["zcat"]
arguments:
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return "|";
         }else{
               return "";
         }
     }
  position: 100
  shellQuote: false
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return "head";
         }else{
               return "";
         }
     }
  position: 101
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return "-n";
         }else{
               return "";
         }
     }
  position: 102
  shellQuote: false
- valueFrom: |
    ${
         if(inputs.max_reads>0){
               return inputs.max_reads*4;
         }else{
               return "";
         }
     }
  position: 103
  shellQuote: false
- valueFrom: "|"
  position: 200
  shellQuote: false
- valueFrom: "split"
  position: 201
- valueFrom: "-"
  position: 202
  shellQuote: false
- valueFrom: $(inputs.file.basename.replace(/\.fastq.*/i,"_splitted.fastq"))
  prefix: --additional-suffix=
  position: 203
  separate: False